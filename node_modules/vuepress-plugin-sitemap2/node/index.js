"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@mr-hope/vuepress-shared"),t=require("chalk"),a=require("fs-extra"),n=require("sitemap");const r=new e.Logger("Sitemap"),s=e=>({defaultPath:e.path.replace(e.pathLocale,"/"),pathLocale:e.pathLocale}),o=async(e,o)=>{r.load("Generating sitemap");const{urls:i=[],xslUrl:p,exclude:l=[],xmlNameSpace:c}=e,u=e.hostname.replace(/\/$/u,""),m=e.outFile?e.outFile.replace(/^\//u,""):"sitemap.xml",{dir:d,options:{base:h}}=o,g=new n.SitemapStream({hostname:u,xslUrl:p,xmlns:c}),f=((e,t)=>{const{changefreq:a="daily",exclude:n=[],dateFormatter:r=(e=>{const{git:t={}}=e;return t.updatedTime?new Date(t.updatedTime).toISOString():""})}=e,{pages:o,options:{base:i,locales:p}}=t,l=o.reduce(((e,t)=>{const{defaultPath:a,pathLocale:n}=s(t),r=e.get(a)||[];return r.push(n),e.set(a,r)}),new Map),c=new Map;return o.forEach((e=>{const t=e.frontmatter.sitemap||{},o=(e.frontmatter.head||[]).find((e=>"robots"===e[1].name));(o?(o[1].content||"").split(/,/u).map((e=>e.trim())).includes("noindex"):t.exclude)&&n.push(e.path);const u=r(e),{defaultPath:m}=s(e),d=l.get(m)||[];let h=[];d.length>1&&(h=d.map((e=>({lang:p[e].lang||"en",url:`${i}${m.replace(/^\//u,e)}`})))),c.set(e.path,{alternateLinks:h,changefreq:a,lastmod:u,...t})})),c})(e,o),x=d.dest(m),w=a.createWriteStream(x);g.pipe(w),f.forEach(((e,t)=>{l.includes(t)||g.write({url:`${h}${t.replace(/^\//u,"")}`,...e})})),i.forEach((e=>g.write(e))),g.end(),r.success(),r.update(`Sitemap generated and saved to ${t.cyan(m)}`),r.load(`Appended sitemap path to ${t.cyan("robots.txt")}`);const $=d.dest("robots.txt"),S=`${(a.existsSync($)?await a.readFile($,{encoding:"utf8"}):"").replace(/^Sitemap: .*$/u,"")}\nSitemap: ${u}${h}${m}\n`;await a.writeFile($,S,{flag:"w"}),r.success()};exports.default=(e,t)=>{const{themeConfig:a}=t.options,n=e.hostname||a.hostname;if(!n)return r.error("Required 'hostname' option is missing!"),{name:"sitemap2"};const s=Object.keys(e).length>0?{...e,hostname:n}:{...a.sitemap||{},hostname:n};return{name:"sitemap2",async onGenerated(){await o(s,t)}}};
//# sourceMappingURL=index.js.map
